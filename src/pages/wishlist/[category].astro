---
import WishlistPage from "@components/wishlist/WishlistPage.astro";
import { getWishlistItems, categories, isValidCategory } from "@lib/wishlist";

export const prerender = false;

Astro.response.headers.set("CDN-Cache-Control", "no-store");

const { category } = Astro.params;

// Redirect /wishlist/all to /wishlist
if (category === "all") {
  return Astro.redirect("/wishlist", 301);
}

// Return 404 for invalid categories
if (!isValidCategory(category)) {
  return new Response(null, { status: 404, statusText: "Not Found" });
}

// export function getStaticPaths() {
//   return validCategoryIds.map((category) => ({
//     params: { category },
//   }));
// }

// const { category } = Astro.params;
const items = await getWishlistItems(category);
---

<WishlistPage
  items={items}
  categories={categories}
  currentCategory={category}
/>
